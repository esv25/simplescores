<!DOCTYPE html>
<html lang="no">
<head>
  <script src="https://cdn.tailwindcss.com"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innstillinger for Scoreboard</title>
    <link rel="stylesheet" href="admin.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            font-size: 2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            font-size: 1.2rem;
            margin-bottom: 8px;
            display: block;
        }

        select, input {
            width: 100%;
            padding: 10px;
            font-size: 1rem;
            border-radius: 4px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 1rem;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }



        .settings-saved {
            display: none;
            color: green;
            font-size: 1.2rem;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-title">
            <a href="nyTurnering.html"><img src="logo.png" alt="Simple Scores Logo" class="logo"></a>
        </div>
        <div class="nav2">
            <button id="user-button" onclick="toggleUserMenu()">Bruker</button>
            <div id="user-menu" class="user-menu" style="display: none;">
                <p>Logget inn som <span id="mail"></span></p>
                <button id="loggut" onclick="loggut()">Logg ut</button>
            </div>
            <button onclick="window.location.href='publikum.html'">Publikum</button>
        </div>
    </header>
    <nav>
        <button class="meny-ikon" id="meny-knapp" aria-label="Åpne meny" aria-expanded="false" aria-controls="meny"></button>
        <ul id="meny">
            <li><a href="slideshow.html">Slideshow</a></li>
            <li><a href="instillinger.html">Instillinger</a></li>
            <li><a href="legg til lag.html">Legg til lag</a></li>
            <li><a href="format.html">Format</a></li>
            <li><a href="kampoppsett.html">Kampoppsett</a></li>
            <li><a href="kamper.html">Kamper</a></li>
        </ul>
    </nav>
    

    <div class="container">
        <div class="form-group">
            <label for="division">Velg divisjon</label>
            <select id="divisionDropdown">
                <!-- Divisjoner vil bli populert her av JavaScript -->
            </select>
            
        </div>

        <div class="form-group">
            <label for="halfDuration">Tid per omgang (minutter)</label>
            <input type="number" id="halfDuration" value="15">
        </div>

        <div class="form-group">
            <label for="numPeriods">Antall omganger</label>
            <input type="number" id="numPeriods" value="2">
        </div>

        <div class="form-group">
            <label for="timeoutDuration">Timeout-lengde (sekunder)</label>
            <input type="number" id="timeoutDuration" value="30">
        </div>
        <div class="form-group">
            <label for="pauseDuration">Pauselengde (sekunder)</label>
            <input type="number" id="pauseDuration" value="60">
        </div>

        <div class="form-group">
            <label for="logGoalScorers">Logg målscorere</label>
            <input type="checkbox" id="logGoalScorers" checked>
        </div>
        <div class="form-group">
            <label for="logYellowCards">Logg gule kort</label>
            <input type="checkbox" id="logYellowCards">
        </div>
        <div class="form-group">
            <label for="logRedCards">Logg røde kort</label>
            <input type="checkbox" id="logRedCards">
        </div>
        <div class="form-group">
            <label for="logPenalties">Logg tidsutvisning (sekund)</label>
            <input type="checkbox" id="logPenalties">
        </div>
        

        <button onclick="saveSettings()">Lagre innstillinger</button>
        <div class="settings-saved" id="settingsSaved">Innstillinger lagret!</div>
        <button onclick="goToKamper()">Tilbake til kamper</button>
    </div>

        
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
    <script src="firebaseConfig.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-auth.js"></script>
    <script>
        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        auth.onAuthStateChanged((user) => {
        if (user) {
        const email = user.email;
        document.getElementById('mail').innerHTML = email;
        } else {
        // Ingen bruker er logget inn, redirect til innloggingssiden
        window.location.href = 'login.html';
        }
        });
        function loggut() {
    auth.signOut().then(() => {
        window.location.href = 'login.html';
    }).catch((error) => {
        console.error("Feil ved utlogging:", error);
    });
}

        // Hent turnerings-ID fra sessionStorage
        const params = new URLSearchParams(window.location.search);
        const turneringId = params.get('id');
        document.addEventListener('DOMContentLoaded', function() {
    // Hent turnerings-ID fra URL-querystring


    if (turneringId) {
      // Gå gjennom alle interne <a>-lenker og legg til query-parametere
      const links = document.querySelectorAll('a');
      links.forEach(link => {
        let href = link.getAttribute('href');
        // Sjekk at href finnes og at det er en relativ lenke
        if (href && !href.startsWith('http') && !href.startsWith('mailto:') && !href.startsWith('#')) {
          const separator = href.includes('?') ? '&' : '?';
          // Legg kun til parameteren hvis den ikke allerede er der
          if (!href.includes('id=')) {
            link.setAttribute('href', href + separator + 'id=' + turneringId);
          }
        }
      });
    }
  });

  function goToKamper() {
    // Henter querystringen fra den nåværende URL-en
    const queryString = window.location.search;
    // Navigerer til 'kamper.html' med querystringen lagt til
    window.location.href = 'kamper.html' + queryString;
}


        if (!turneringId) {
            alert('Turnerings-ID ikke funnet. Du må velge en turnering.');
            window.location.href = 'kamper.html'; // Tilbake til kamplisten
        }
        function saveSettings() {
    const division = document.getElementById('divisionDropdown').value;
    const halfDuration = document.getElementById('halfDuration').value;
    const numPeriods = document.getElementById('numPeriods').value;
    const timeoutDuration = document.getElementById('timeoutDuration').value;
    const pauseDuration = document.getElementById('pauseDuration').value;  // Ny variabel
    const logGoalScorers = document.getElementById('logGoalScorers').checked;
    const logYellowCards = document.getElementById('logYellowCards').checked;
    const logRedCards    = document.getElementById('logRedCards').checked;
    const logPenalties   = document.getElementById('logPenalties').checked;

    // Lagre innstillingene i Firestore under turneringen
    db.collection('turneringer').doc(turneringId)
      .collection('settings').doc(division)
      .set({
            halfDuration: parseInt(halfDuration),
            numPeriods: parseInt(numPeriods),
            timeoutDuration: parseInt(timeoutDuration),
            pauseDuration: parseInt(pauseDuration),  // Lagre den nye innstillingen
            logGoalScorers: logGoalScorers,
            logYellowCards: logYellowCards,
            logRedCards:    logRedCards,
            logPenalties:   logPenalties
      })
      .then(() => {
          document.getElementById('settingsSaved').style.display = 'block';
          setTimeout(() => {
              document.getElementById('settingsSaved').style.display = 'none';
          }, 3000);
      })
      .catch((error) => {
          console.error('Feil ved lagring av innstillinger:', error);
      });
}

        async function populateDivisionDropdown() {
            try {
                // Hent turnerings-ID fra sessionStorage (allerede lagret på klienten)


                if (!turneringId) {
                    console.error('Turnerings-ID mangler. Kan ikke hente divisjoner.');
                    return;
                }

                // Hent turneringsdata fra Firestore
                const docRef = db.collection('turneringer').doc(turneringId);
                const doc = await docRef.get();

                if (!doc.exists) {
                    console.error('Fant ikke turneringsdokumentet.');
                    return;
                }



                // Hent divisjonene fra turneringsdokumentet
                const tournamentData = doc.data();
                const divisions = tournamentData.divisions || [];

                // Finn dropdown-menyen som skal oppdateres
                const divisionDropdown = document.getElementById('divisionDropdown');

                if (!divisionDropdown) {
                    console.error('Dropdown med ID "divisionDropdown" ble ikke funnet.');
                    return;
                }

                // Tøm dropdown før oppdatering
                divisionDropdown.innerHTML = '';

                // Legg til standard "Velg divisjon"-alternativ
                const defaultOption = document.createElement('option');
                defaultOption.textContent = 'Velg divisjon';
                defaultOption.value = '';
                divisionDropdown.appendChild(defaultOption);

                // Populer med divisjonene
                divisions.forEach(division => {
                    const option = document.createElement('option');
                    option.textContent = division.name; // Bruk name-egenskapen
                    option.value = division.name; // Bruk name-egenskapen som verdi
                    divisionDropdown.appendChild(option);
                });
            } catch (error) {
                console.error('Feil ved henting av divisjoner:', error);
            }
        }

        // Kall funksjonen når siden lastes
        document.addEventListener('DOMContentLoaded', populateDivisionDropdown);

        document.addEventListener('DOMContentLoaded', function() {
        var menyKnapp = document.getElementById('meny-knapp');
        var meny = document.getElementById('meny');

        menyKnapp.addEventListener('click', function() {
            meny.classList.toggle('meny-åpen');
            menyKnapp.classList.toggle('åpen');

            var erApen = meny.classList.contains('meny-åpen');
            menyKnapp.setAttribute('aria-expanded', erApen);
            if (erApen) {
                menyKnapp.setAttribute('aria-label', 'Lukk meny');
            } else {
                menyKnapp.setAttribute('aria-label', 'Åpne meny');
            }
        });
    });
    </script>
</body>
</html>
