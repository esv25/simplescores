<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toppscorere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
    <script src="firebaseConfig.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-firestore.js"></script>
</head>
<body>
    <header>
        <div class="logo-title">
            <img src="logo.png" alt="Simple Scores Logo" class="logo">
        </div>
        <button onclick="window.location.href='publikum.html'">Hjem</button>
    </header>
    <main>
        <h2>Toppscorerliste</h2>
        <ol id="scorerList" class="scorers-list"></ol>
    </main>
    <footer>
        <p>&copy; 2024 Turneringer. Alle rettigheter reservert.</p>
    </footer>
<script>
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const tournamentId = new URLSearchParams(window.location.search).get('tournamentid');
if (!tournamentId) {
    window.location.href = 'publikum.html';
}
async function fetchTopScorers() {
    try {
        const matchesSnap = await db.collection('turneringer').doc(tournamentId).collection('kamper').get();
        const scorerCounts = {};
        for (const matchDoc of matchesSnap.docs) {
            const goalsSnap = await matchDoc.ref.collection('goals').get();
            goalsSnap.forEach(g => {
                const player = g.data().spiller || 'Ukjent';
                if (player === 'ikke-definert' || player === 'selvmål') return;
                scorerCounts[player] = (scorerCounts[player] || 0) + 1;
            });
        }
        const sorted = Object.entries(scorerCounts).sort((a,b) => b[1]-a[1]);
        const list = document.getElementById('scorerList');
        if (sorted.length === 0) {
            list.innerHTML = '<li>Ingen mål registrert.</li>';
            return;
        }
        list.innerHTML = sorted.map(([player,count], idx) => `
            <li><span class="player-name">${idx+1}. ${player}</span> - <span class="goal-details">${count} mål</span></li>
        `).join('');
    } catch(err){
        console.error('Feil ved henting av toppscorere:', err);
        document.getElementById('scorerList').innerHTML = '<li>En feil oppstod.</li>';
    }
}
document.addEventListener('DOMContentLoaded', fetchTopScorers);
</script>
</body>
</html>
